# 流水线开发文档

## 流水线寄存器位数的问题

## rs2寄存器和前递单元的冲突

在i型指令中,rs2的值没有用到,但是会被前递单元检测从而导致最终选择的数据错误,但是这个错误本质上来源于alu的输入信号选择问题,应该先进行前递选择后进行立即数等的选择

## lui的前递问题

在原有架构中,通过一个选择信号直接选择将立即数传递给目的寄存器,但是在发生前递问题时,由于前递的是流水线寄存器中alu的结果,所以立即数不能被正确传递,所以我们更改了架构,将lui也通过alu进行计算,通过一个lui信号选择,将alu的第一个输入信号始终置0,这样alu的结果即是立即数,这样可以解决涉及lui的前递问题

## sw的前递问题

```assembly
addi x2,x2,1
sw x2,0(x1) 
```

like this:
     c1  c2  c3  c4  c5
addi IF  ID  EX  MEM WB
sw       IF  ID  EX  MEM WB
前递单元只解决了alu的来源问题,但是sw写入的数据不来自于alu,而是直接来自于rs2,因此rs2的值传递也需要前递单元来保证数据的正确性

## lw的前递问题

目前的架构中前递单元传递的是MEM/WB中的ALUout值,当lw指令发生前递时,写入目的寄存器的值应该是从内存中读取的值而不是alu的值,这里用一个选择器
